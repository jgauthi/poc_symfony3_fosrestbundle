imports:
    - { resource: parameters.yml }
    - { resource: security.yml }
    - { resource: services.yml }
    - { resource: "@PlatformBundle/Resources/config/services.yml" }
    - { resource: "@MyRestBundle/Resources/config/services.yml" }

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices/configuration.html#application-related-configuration
parameters:
    locale: fr
    cache_type: file_system

framework:
    #esi: ~
    translator: { fallbacks: ['%locale%'] }
    secret: '%secret%'
    router:
        resource: '%kernel.project_dir%/app/config/routing.yml'
        strict_requirements: ~
    form: ~
    csrf_protection: ~
    validation: { enable_annotations: true }
    serializer:
      enabled: true
      #enable_annotations: true
    default_locale: '%locale%'
    trusted_hosts: ~
    session:
        # https://symfony.com/doc/current/reference/configuration/framework.html#handler-id
        handler_id: session.handler.native_file
        save_path: '%kernel.project_dir%/var/sessions/%kernel.environment%'
    fragments: ~
    http_method_override: true
    assets: ~
    php_errors:
        log: true
    templating:
        engines: ['twig']

# Twig Configuration
twig:
    debug: '%kernel.debug%'
    strict_variables: '%kernel.debug%'
    form_themes:
      - 'bootstrap_3_layout.html.twig'
    globals:
      webmaster: '%app_webmaster%'
    number_format:
        decimals: 0
        decimal_point: ,
        thousands_separator: ' '

# Doctrine Configuration
doctrine:
    dbal:
        driver: pdo_mysql
        host: '%database_host%'
        port: '%database_port%'
        dbname: '%database_name%'
        user: '%database_user%'
        password: '%database_password%'
        charset: UTF8
        # if using pdo_sqlite as your database driver:
        #   1. add the path in parameters.yml
        #     e.g. database_path: '%kernel.project_dir%/var/data/data.sqlite'
        #   2. Uncomment database_path in parameters.yml.dist
        #   3. Uncomment next line:
        #path: '%database_path%'

    orm:
        auto_generate_proxy_classes: '%kernel.debug%'
        naming_strategy: doctrine.orm.naming_strategy.underscore
        auto_mapping: true

# Gestion des utilisateurs
fos_user:
  db_driver: orm
  firewall_name: main
  user_class: MyUserBundle\Entity\User
  from_email:
    address: "%mailer_from%"
    sender_name: "%app_webmaster%"
  service:
      mailer: fos_user.mailer.twig_swift
#  registration:
#    form:
#      type: AppBundle\Form\RegistrationType

# Rest API
fos_rest:
  routing_loader:
    include_format: false
    default_format: json
  view:
    view_response_listener: true
    formats:
      json: true
      xml: true
  zone:
    - { path: '^/[a-z]{2}/api/v[0-9]' }
  format_listener:
    rules:
      - { path: '^/[a-z]{2}/api/v[0-9]/', priorities: ['json','xml'], fallback_format: 'json', prefer_extension: false }
  body_listener:
    enabled: true
  param_fetcher_listener:
    enabled: true
  exception:
    enabled: true
    messages:
      'Symfony\Component\HttpKernel\Exception\HttpException': true
      'Symfony\Component\Security\Core\Exception\BadCredentialsException': true
    codes:
      'Symfony\Component\Security\Core\Exception\BadCredentialsException': 401

# Api Rest Documentation
nelmio_api_doc: ~

# Stof\DoctrineExtensionsBundle configuration
stof_doctrine_extensions:
    orm:
        default:
            sluggable: true

# Swiftmailer Configuration
swiftmailer:
    transport: '%mailer_transport%'
    host: '%mailer_host%'
    username: '%mailer_user%'
    password: '%mailer_password%'
    spool: { type: memory }
    auth_mode: cram-md5
    port: '%mailer_port%'

assetic:
  debug:          '%kernel.debug%'
  use_controller: '%kernel.debug%'
  filters:
    cssrewrite: ~
    jsqueeze:   ~
    scssphp:
      formatter: 'Leafo\ScssPhp\Formatter\Compressed'

doctrine_cache:
  providers:
    my_markdown_cache:
      type: '%cache_type%'
      # directory: %kernel.cache_dir%/markdown_cache

# Easy Admin Bundle
easy_admin:
    site_name: 'Platform <em style="font-size: 80%;">Admin</em>'
    list:
        max_results: 30
    formats:
        date:     'd/m/Y'
        time:     'H\hi'
        datetime: 'd/m/Y Ã  H\hi'
    entities:
        Advert:
            class: PlatformBundle\Entity\Advert
            label: 'Advert'
            list:
                title: "Most recent %%entity_label%%"
                help: 'The list view overrides the global help message'
                max_results: 20
                actions: [ 'show', 'edit', 'search' ]
                fields: [ 'id', 'title', 'author', 'date', 'categories', 'published' ]
            show:
                title: '%%entity_label%% (#%%entity_id%%)'
            search:
                fields: ['id', 'title', 'slug', 'author', 'date', 'image', 'published']
            form:
                title: 'Add advert'
                fields: [ 'title', 'author', 'date', 'published', 'categories' ]
            disabled_actions: ['new']
        AdvertSkill:
            class: PlatformBundle\Entity\AdvertSkill
            label: 'Advert Skill'
            list:
              fields: [ 'id', 'skill', 'level', 'advert' ]
            form:
              fields: [ 'skill', 'level', 'advert' ]
        Application:
            class: PlatformBundle\Entity\Application
            label: 'Applications'
            list:
                title: 'Advert''s applications'
                actions: [ 'show', '-edit', 'search' ]
                fields:
                  - id
                  - author
                  - content
                  - city
                  - salaryclaim
                  - { property: 'advert.title', label: 'Advert Title' }
                  - { property: 'date', format: 'j/n/Y' }
                  - { property: 'advert', label: 'Associated advert'}
                sort: ['date', 'DESC']
                actions:
                    - { name: 'show', icon: 'search', label: false }
                    - { name: 'edit', icon: 'pencil', label: false }
            form:
                fields: [ 'author', 'content' , { property: 'date', type_options: { widget: 'single_text' }}, 'advert' ]
            disabled_actions: ['new']
        Category:
            class: PlatformBundle\Entity\Category
        Image:
            class: PlatformBundle\Entity\Image
            list:
              fields: [ 'id', 'alt', { property: 'url', type: 'image', label: 'Image overview' } ]
        AuthToken:
            class: MyRestBundle\Entity\AuthToken
            disabled_actions: ['new']
        User:
            class: MyUserBundle\Entity\User
            list:
              fields: [ 'id', 'username', 'email', 'enabled', 'lastLogin', 'roles' ]
            form:
              fields:
                  - username
                  - email
                  - enabled
                  - { property: 'plainPassword', type: 'text', type_options: { required: false } }
                  - { property: 'roles', type: 'choice', type_options: { multiple: true, choices: { 'ROLE_USER': 'ROLE_USER', 'ROLE_AUTEUR': 'ROLE_AUTEUR', 'ROLE_API_ACCESS': 'ROLE_API_ACCESS', 'ROLE_ADMIN': 'ROLE_ADMIN' } } }
    design:
        brand_color: '#14937a'
        color_scheme: 'dark'
        form_theme: 'horizontal'
        # Icon: https://fontawesome.com/icons
        menu:
          - label: 'Content'
            icon: 'save'
            children:
              - { entity: 'Advert', icon: 'bullhorn' }
              - { entity: 'AdvertSkill', icon: 'address-card' }
              - { entity: 'Application', icon: 'eye ' }
              - { entity: 'Category', icon: 'compass' }
              - Image
          - label: 'Management'
            icon: 'building'
            children:
              - { entity: 'User', icon: 'users' }
              - { entity: 'AuthToken', icon: 'universal-access' }
          - label: 'About'
            icon: 'building'
            children:
            - { label: 'Symfony doc', url: 'https://symfony.com/doc/current/', target: '_blank', icon: 'code' }
            - { label: 'Front End', route: 'oc_platform_home', icon: 'home' }
